<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>menu</title>
        <link rel="stylesheet" href="/lib/layui-v2.5.5/css/layui.css" media="all">
        <link rel="stylesheet" href="/css/public.css" media="all">
        <style>
            .layui-btn:not(.layui-btn-lg ):not(.layui-btn-sm):not(.layui-btn-xs) {
                height: 34px;
                line-height: 34px;
                padding: 0 8px;
            }
        </style>
    </head>
    <body>
        <div class="layuimini-container">
            <div class="layuimini-main">
                <blockquote class="layui-elem-quote">
                    Layui的树形表格treeTable，支持异步加载(懒加载)、复选框联动、折叠状态记忆。
                    <br>
                    <a href="https://gitee.com/whvse/treetable-lay" target="_blank" class="layui-btn layui-btn-danger">
                        treetable-lay
                    </a>
                </blockquote>
                <div>
                    <div class="layui-btn-group">
                        <button class="layui-btn" id="btn-expand">全部展开</button>
                        <button class="layui-btn layui-btn-normal" id="btn-fold">全部折叠</button>
                    </div>
                    <table id="munu-table" class="layui-table" lay-filter="munu-table"></table>
                </div>
            </div>
        </div>
        <!-- 操作列 -->
        <script type="text/html" id="auth-state">
            <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        </script>
        <!-- 表单弹窗 -->
        <script type="text/html" id="authoritiesEditDialog">
            <form id="authoritiesEditForm" lay-filter="authoritiesEditForm" class="layui-form model-form"
                  style="padding-right: 20px;">
                <input name="authorityId" type="hidden"/>
                <div class="layui-row">
                    <div class="layui-col-md6">
                        <div class="layui-form-item">
                            <label class="layui-form-label">上级菜单</label>
                            <div class="layui-input-block">
                                <div id="authoritiesEditParentSel" class="ew-xmselect-tree"></div>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label layui-form-required">权限名称:</label>
                            <div class="layui-input-block">
                                <input name="authorityName" placeholder="请输入权限名称" class="layui-input"
                                       lay-verType="tips" lay-verify="required" required/>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">搜索选择框</label>
                            <div class="layui-input-inline">
                                <select name="modules" lay-verify="required" lay-search="">
                                    <option value="">直接选择或搜索选择</option>
                                    <option value="1">layer</option>
                                    <option value="2">form</option>
                                    <option value="3">layim</option>
                                    <option value="4">element</option>
                                    <option value="5">laytpl</option>
                                    <option value="6">upload</option>
                                    <option value="7">laydate</option>
                                    <option value="8">laypage</option>
                                    <option value="9">flow</option>
                                    <option value="10">util</option>
                                    <option value="11">code</option>
                                    <option value="12">tree</option>
                                    <option value="13">layedit</option>
                                    <option value="14">nav</option>
                                    <option value="15">tab</option>
                                    <option value="16">table</option>
                                    <option value="17">select</option>
                                    <option value="18">checkbox</option>
                                    <option value="19">switch</option>
                                    <option value="20">radio</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label layui-form-required">权限类型:</label>
                            <div class="layui-input-block">
                                <input name="isMenu" type="radio" value="0" title="菜单" checked/>
                                <input name="isMenu" type="radio" value="1" title="按钮"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">菜单url:</label>
                            <div class="layui-input-block">
                                <input name="menuUrl" placeholder="请输入菜单url" class="layui-input"/>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md6">
                        <div class="layui-form-item">
                            <label class="layui-form-label">权限标识:</label>
                            <div class="layui-input-block">
                                <input name="authority" placeholder="请输入权限标识" class="layui-input"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">菜单图标:</label>
                            <div class="layui-input-block">
                                <input name="menuIcon" placeholder="请输入菜单图标" class="layui-input"/>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label layui-form-required">排序号:</label>
                            <div class="layui-input-block">
                                <input name="orderNumber" placeholder="请输入排序号" type="number" class="layui-input"
                                       lay-verType="tips" lay-verify="required|number" required/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item text-right">
                    <button class="layui-btn" lay-filter="authoritiesEditSubmit" lay-submit>保存</button>
                    <button class="layui-btn layui-btn-primary" type="button" ew-event="closeDialog">取消</button>
                </div>
            </form>
        </script>
        <script src="/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
        <script src="/js/lay-config.js?v=1.0.4" charset="utf-8"></script>
        <script>
            layui.use(['table', 'treetable', 'form', 'layedit', 'laydate'], function () {
                var $ = layui.jquery;
                var table = layui.table;
                var treetable = layui.treetable,
                    form = layui.form
                    , layedit = layui.layedit
                    , laydate = layui.laydate;

                // 渲染表格
                layer.load(2);
                treetable.render({
                    treeColIndex: 1,
                    treeSpid: -1,
                    treeIdName: 'id',
                    treePidName: 'parentId',
                    elem: '#munu-table',
                    // url: '/api/menus.json',
                    url: '/menu/list',
                    page: false,
                    cols: [[
                        {type: 'numbers'},
                        {field: 'menuName', minWidth: 200, title: '权限名称'},
                        // {field: 'authority', title: '权限标识'},
                        {field: 'url', title: '菜单url'},
                        {field: 'sort', width: 80, align: 'center', title: '排序号'},
                        {
                            field: 'isMenu', width: 80, align: 'center', templet: function (d) {
                                if (d.isMenu == 1) {
                                    return '<span class="layui-badge layui-bg-gray">按钮</span>';
                                }
                                if (d.parentId == -1) {
                                    return '<span class="layui-badge layui-bg-blue">目录</span>';
                                } else {
                                    return '<span class="layui-badge-rim">菜单</span>';
                                }
                            }, title: '类型'
                        },
                        {templet: '#auth-state', width: 120, align: 'center', title: '操作'}
                    ]],
                    done: function () {
                        layer.closeAll('loading');
                    }
                });

                $('#btn-expand').click(function () {
                    treetable.expandAll('#munu-table');
                });

                $('#btn-fold').click(function () {
                    treetable.foldAll('#munu-table');
                });
                //监听工具条
                table.on('tool(munu-table)', function (obj) {
                    var data = obj.data;
                    var layEvent = obj.event;

                    if (layEvent === 'del') {
                        layer.msg('删除' + data.id);
                    } else if (layEvent === 'edit') {
                        // layer.msg('修改' + data.id);、
                        getById(data.id);

                        layer.open({
                            type: 1
                            // , title: '修改菜单' //不显示标题栏
                            // , closeBtn: false
                            , area: '600px;'
                            // , shade: 0.8
                            , id: 'LAY_layuipro' //设定一个id，防止重复弹出
                            // , btn: ['保存', '关闭']
                            // , btnAlign: 'c'
                            // , moveType: 0 //拖拽模式，0或者1
                            // ,content: '<div style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">你知道吗？亲！<br>layer ≠ layui<br><br>layer只是作为Layui的一个弹层模块，由于其用户基数较大，所以常常会有人以为layui是layerui<br><br>layer虽然已被 Layui 收编为内置的弹层模块，但仍然会作为一个独立组件全力维护、升级。<br><br>我们此后的征途是星辰大海 ^_^</div>'
                            ,content: $("#authoritiesEditDialog").html(),
                            // resize: false,
                             success: function (layero) {
                                var btn = layero.find('.layui-layer-btn');
                                btn.find('.layui-layer-btn0').attr({
                                    href: 'http://www.layui.com/'
                                    , target: '_blank'
                                });
                            }
                        });
                    }
                });

                function getById(id) {
                    $.get('/menu/get/' + id,function (res) {
                        form.val('editMenu',res.content)
                    })
                }
            });



        </script>
    </body>
    <div class="layuimini-main" id="modifyMenu" style="display: none">

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>修改菜单</legend>
        </fieldset>

        <form class="editMenu" action="">
            <div class="layui-form-item">
                <label class="layui-form-label">菜单名称</label>
                <div class="layui-input-block">
                    <input type="text" name="menuName" lay-verify="required" lay-reqtext="菜单名称是必填项，岂能为空？" placeholder="请输入菜单名称" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">URL</label>
                <div class="layui-input-block">
                    <input type="text" name="url" lay-verify="title" autocomplete="off" placeholder="请输入URL" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">图标</label>
                <div class="layui-input-block">
                    <input type="text" name="url" lay-verify="title" autocomplete="off" placeholder="请输入URL" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">搜索选择框</label>
                <div class="layui-input-inline">
                    <select name="modules" lay-verify="required" lay-search="">
                        <option value="">直接选择或搜索选择</option>
                        <option value="1">layer</option>
                        <option value="2">form</option>
                        <option value="3">layim</option>
                        <option value="4">element</option>
                        <option value="5">laytpl</option>
                        <option value="6">upload</option>
                        <option value="7">laydate</option>
                        <option value="8">laypage</option>
                        <option value="9">flow</option>
                        <option value="10">util</option>
                        <option value="11">code</option>
                        <option value="12">tree</option>
                        <option value="13">layedit</option>
                        <option value="14">nav</option>
                        <option value="15">tab</option>
                        <option value="16">table</option>
                        <option value="17">select</option>
                        <option value="18">checkbox</option>
                        <option value="19">switch</option>
                        <option value="20">radio</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">排序</label>
                    <div class="layui-input-inline" style="width: 100px;">
                        <input type="text" name="sort" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">类型</label>
                <div class="layui-input-block">
                    <input type="radio" name="sex" value="0" title="按钮" checked="">
                    <input type="radio" name="sex" value="1" title="菜单">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
</html>